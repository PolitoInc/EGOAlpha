{% load static %}
<!doctype html>
<html lang="en">
<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="{% static 'css/StyleSheet1.css' %}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <title>Consume Rest Api</title>
</head>
<body>
    <div class="GridPKCustomer">
        <form action="/logout" method="post">
    <input type="submit" value="Logout">
    </form>


        <div class="title">
            <h1>Customers</h1>
        </div>
        <div class="sidenav">
            <img src="{% static 'img/Politoinc.png' %}">
            <a href="{% url 'CustomerVIEW' %}" class="button"><span class="text">Customers</span></a>
            <a href="{% url 'EgoControlBoards' %}" class="button"><span class="text">EgoControlBoards</span></a>
            <a href="{% url 'GnawControlBoards' %}"><span class="text">GnawBoards</span></a>
            <button class="dropdown-btn">
                VulnBoard
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-container">
                <a href="{% url 'VulnBoards' %}">
                    <span class="text">List</span>
                </a>
                <a href="{% url 'VulnBoardCreate' %}">
                    <span class="text">Create</span>
                </a>
            </div>

            <a href="#contact">Search</a>
        </div>



        <div class="PKcontainerNmap">
            <div class="description">
                {{Customer.id}}</br>
                {{Customer.groupingProject}}</br>
                {{Customer.nameProject}}</br>
                {{Customer.nameCustomer}}</br>
                {{Customer.dateCreated}}</br>
                {{Customer.customDaysUntilNextScan}}</br>
                {{Customer.toScanDate}}</br>
                {{Customer.endToScanDate}}</br>
                {{Customer.URLCustomer}}</br>
                {{Customer.lastScan}}</br>
            </div>
            <div class="Alive_styles">
                <h1>Alive</h1>
                <h3>NetWork</h3>
                {% for record in Customer.customer_records %}
                {% if record.alive %}
                {{record.subDomain}}</br>
                {{record.ip}}</br>
                {{record.OpenPorts}}</br>

                <h3>Certificates</h3>
                {% for n in record.Certificates_record %}

                {% if n.C %}
                <span>{{n.C}}</span>
                {% endif %}
                {% if n.ST %}
                <span>{{n.ST}}</span>
                {% endif %}
                {% if n.L %}
                <span>{{n.L}}</span>
                {% endif %}
                {% if n.O %}
                <span>{{n.O}}</span>
                {% endif %}
                {% if n.OU %}
                <span>{{n.OU}}</span>
                {% endif %}
                {% if n.CN %}
                <span>{{n.CN}}</span>
                {% endif %}
                {% if n.PEM %}
                <span>{{n.PEM}}</span>
                {% endif %}
                </br>
                {% endfor %}

                <h3>DNS Query</h3>
                {% for n in record.DNSQuery_record %}
                {% if n.A %}
                A Record: {{n.A}}
                {% endif %}
                {% if n.AAAA %}
                {{n.AAAA}}
                {% endif %}
                {% if n.NS %}
                {{n.NS}}
                {% endif %}
                {% if n.CNAME %}
                {{n.CNAME}}
                {% endif %}
                {% if n.r %}
                {{n.OU}}
                {% endif %}
                {% if n.MX %}
                {{n.MX}}
                {% endif %}
                {% if n.TXT %}
                {{n.TXT}}
                {% endif %}
                {% if n.TXT %}
                {{n.ANY}}
                {% endif %}

                </br>
                {% endfor %}

                <h3>Nmap</h3>
                {% if record.Nmaps_record %}

                {% for nm in record.Nmaps_record %}

                {% if nm.name != 'tcpwrapped' %}


                {% if nm.name %}
                Name: {{nm.name}}</br>
                {% endif %}
                {% if nm.port %}
                Port: {{nm.port}}</br>
                {% endif %}
                {% if nm.protocol %}
                protocol: {{nm.protocol}}</br>
                {% endif %}
                {% if nm.service %}
                service: {{nm.service}}</br>
                {% endif %}
                {% if nm.cpe %}
                cpe: {{nm.cpe}}</br>
                {% endif %}
                {% if nm.scripts %}
                scripts: {{nm.scripts.0}}</br>
                {% endif %}
                {% if nm.conf %}
                conf: {{nm.conf}}</br>
                {% endif %}
                {% if nm.extrainfo %}
                extrainfo: {{nm.extrainfo}}</br>
                {% endif %}
                {% if nm.method %}
                method: {{nm.method}}</br>
                {% endif %}
                {% if nm.ostype %}
                osType: {{nm.ostype}}
                {% endif %}
                {% if nm.product %}
                product: {{nm.product}}
                {% endif %}
                {% if nm.version %}
                version: {{nm.version}}
                {% endif %}

                {% if nm.state %}
                state: {{nm.state}}
                {% endif %}
                {% if nm.hostname %}
                hostname: {{nm.hostname}}
                {% if nm.macaddress %}
                A Record: {{nm.macaddress}}
                {% endif %}
                {% endif %}
                {% endif %}
                {%endfor%}
                <form action="/Record/{{record.id}}/delete" method="GET">
                    {% csrf_token %}
                    <input type="hidden" name="_method" value="delete">
                    <input type="submit" value="Delete">
                </form>
                {% endif %}
                {% endif %}
                {% endfor %}
            </div>
            <div class="Dead_styles">
                <h2>DEAD</h2>
                {% for record in Customer.customer_records %}
                {% if record.alive == False%}
                {{record.subDomain}}</br>
                {% endif %}

                {% endfor %}
            </div>
        </div>

        <div class="PKcontainerVulnList">

            <div id="container" class="Chart_CustomerPK">
                <canvas id="VulnsBoardChartPK" data-url="{% url 'VulnsBoardChartPK' Customer.id  %}"></canvas>
            </div>

            <div class="Vulnerabilities">
                <h2>Vulnerabilities</h2>
                {% for record in Customer.customer_records %}
                {% for tv in record.Templates_record %}
                <hr style="border: 10px solid green;">
                <h4>{{tv.info.name}}</h4>
                {{tv.info.author}}</br>
                {{tv.info.severity}}</br>
                {{tv.matched_at}}</br>
                {{tv.info.classification.4}}</br>
                {{tv.info.description}}</br>
                {{tv.info.reference}}</br>
                {{tv.info.tags}}</br>
                {{tv.curl_command}}</br>
                {% endfor %}
                {% for fv in record.foundVuln_record %}
                <hr style="border: 10px solid green;">
                {{fv.name}}</br>
                {{fv.vulnClass}}</br>
                {{fv.severity}}</br>
                {{fv.DomainName}}</br>
                {% for f in fv.location %}
                <a href="{{f}}">{{f}}</a></br>
                {% endfor %}

                {% if fv.match_headers%}
                <fieldset>
                    <legend>Matched at headers:</legend>
                    <span>{{fv.matchedAt_headers}}</span>
                </fieldset>
                {% endif %}
                {% if fv.match_bodys%}
                <fieldset>
                    <legend>matched at body:</legend>
                    <span>{{fv.match_bodys}}</span>
                </fieldset>
                {% endif %}
                {% if fv.matchedAt_bodys%}
                <fieldset>
                    <legend>matched at words:</legend>
                    <span>{{fv.matchedAt_bodys}} </span>
                </fieldset>
                {% endif %}
                {{fv.name}}</br>
                button
                {{fv.Submitted}}
                <form action="/VulnBoard/submited/{{fv.id}}" method="POST">
                    {% csrf_token %}
                    {{ submit.as_p }}
                    <input type="submit" value="Submit">
                </form>
                {% endfor %}
                {% endfor %}
            </div>



        </div>

        <div class="PK_Create">
            <form action="{% url 'CustomerPk' Customer.id %}" method="post">
                {% csrf_token %}
                {{form.as_p }}
                <input type="submit" value="Submit">
            </form>
        </div>


    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script>

        $(function () {

            var $VulnsBoardChartPK = $("#VulnsBoardChartPK");
            $.ajax({
                url: $VulnsBoardChartPK.data("url"),
                success: function (data) {

                    var ctx = $VulnsBoardChartPK[0].getContext("2d");

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.labels,
                            datasets: [{
                                label: 'severity',
                                backgroundColor: 'blue',
                                label: 'severity',
                                data: data.data
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'Vulnerability Bar Chart'
                            }
                        }
                    });

                }
            });

        });

    </script>
    <script>
        /* Loop through all dropdown buttons to toggle between hiding and showing its dropdown content - This allows the user to have multiple dropdowns without any conflict */
        var dropdown = document.getElementsByClassName("dropdown-btn");
        var i;

        for (i = 0; i < dropdown.length; i++) {
            dropdown[i].addEventListener("click", function () {
                this.classList.toggle("active");
                var dropdownContent = this.nextElementSibling;
                if (dropdownContent.style.display === "block") {
                    dropdownContent.style.display = "none";
                } else {
                    dropdownContent.style.display = "block";
                }
            });
        }
    </script>
</body>
</html>